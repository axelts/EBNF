<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<!-- title>EBNF  Tutorial: B: The Stack Machine</title -->
	<title>B: The Stack Machine</title> <!-- ats -->

	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">
	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">
	<link type="text/css" rel="stylesheet" href="style.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">The Book</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-BNF.html">BNF</a></li><li><a href="module-Base.html">Base</a></li><li><a href="module-EBNF.html">EBNF</a></li><li><a href="module-Eight.html">Eight</a></li><li><a href="module-Eleven.html">Eleven</a></li><li><a href="module-Five.html">Five</a></li><li><a href="module-GUI.html">GUI</a></li><li><a href="module-Practice.html">Practice</a></li><li><a href="module-Script.html">Script</a></li><li><a href="module-Seven.html">Seven</a></li><li><a href="module-Six.html">Six</a></li><li><a href="module-Ten.html">Ten</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-BNF-Actions.html">BNF~Actions</a></li><li><a href="module-BNF-Grammar.html">BNF~Grammar</a></li><li><a href="module-BNF-Lit.html">BNF~Lit</a></li><li><a href="module-BNF-Mark.html">BNF~Mark</a></li><li><a href="module-BNF-Message.html">BNF~Message</a></li><li><a href="module-BNF-NT.html">BNF~NT</a></li><li><a href="module-BNF-Parser.html">BNF~Parser</a></li><li><a href="module-BNF-Rule.html">BNF~Rule</a></li><li><a href="module-BNF-State.html">BNF~State</a></li><li><a href="module-BNF-Token.html">BNF~Token</a></li><li><a href="module-Base-Factory.html">Base~Factory</a></li><li><a href="module-Base-Lit.html">Base~Lit</a></li><li><a href="module-Base-NT.html">Base~NT</a></li><li><a href="module-Base-Parser.html">Base~Parser</a></li><li><a href="module-Base-Precedence.html">Base~Precedence</a></li><li><a href="module-Base-Scanner.html">Base~Scanner</a></li><li><a href="module-Base-Symbol.html">Base~Symbol</a></li><li><a href="module-Base-T.html">Base~T</a></li><li><a href="module-Base-Token.html">Base~Token</a></li><li><a href="module-Base-Tuple.html">Base~Tuple</a></li><li><a href="module-EBNF-Actions.html">EBNF~Actions</a></li><li><a href="module-EBNF-Alt.html">EBNF~Alt</a></li><li><a href="module-EBNF-Grammar.html">EBNF~Grammar</a></li><li><a href="module-EBNF-Lit.html">EBNF~Lit</a></li><li><a href="module-EBNF-NT.html">EBNF~NT</a></li><li><a href="module-EBNF-Opt.html">EBNF~Opt</a></li><li><a href="module-EBNF-Parser.html">EBNF~Parser</a></li><li><a href="module-EBNF-Rule.html">EBNF~Rule</a></li><li><a href="module-EBNF-Seq.html">EBNF~Seq</a></li><li><a href="module-EBNF-Set.html">EBNF~Set</a></li><li><a href="module-EBNF-Some.html">EBNF~Some</a></li><li><a href="module-EBNF-Token.html">EBNF~Token</a></li><li><a href="module-Eight-First14_Fun.html">Eight~First14#Fun</a></li><li><a href="module-Eight-First14_Var.html">Eight~First14#Var</a></li><li><a href="module-Eight-Global01_Fun.html">Eight~Global01#Fun</a></li><li><a href="module-Eight-Global01_Type.html">Eight~Global01#Type</a></li><li><a href="module-Eight-Global01_Var.html">Eight~Global01#Var</a></li><li><a href="module-Eight-Machine14_Memory.html">Eight~Machine14#Memory</a></li><li><a href="module-Eight-Pass08_Fun.html">Eight~Pass08#Fun</a></li><li><a href="module-Eight-Pass08_Var.html">Eight~Pass08#Var</a></li><li><a href="module-Eleven-Build.html">Eleven~Build</a></li><li><a href="module-Eleven-Check.html">Eleven~Check</a></li><li><a href="module-Eleven-Code.html">Eleven~Code</a></li><li><a href="module-Eleven-Visit.html">Eleven~Visit</a></li><li><a href="module-Five-Actions14.html">Five~Actions14</a></li><li><a href="module-Five-Actions15.html">Five~Actions15</a></li><li><a href="module-Five-Actions16.html">Five~Actions16</a></li><li><a href="module-Practice-Model.html">Practice~Model</a></li><li><a href="module-Seven-Blocks09.html">Seven~Blocks09</a></li><li><a href="module-Seven-Blocks09_Block.html">Seven~Blocks09#Block</a></li><li><a href="module-Seven-Blocks09_Fun.html">Seven~Blocks09#Fun</a></li><li><a href="module-Seven-Blocks09_Symbol.html">Seven~Blocks09#Symbol</a></li><li><a href="module-Seven-Blocks09_Var.html">Seven~Blocks09#Var</a></li><li><a href="module-Seven-Functions04.html">Seven~Functions04</a></li><li><a href="module-Seven-Functions04_Fun.html">Seven~Functions04#Fun</a></li><li><a href="module-Seven-Functions04_Symbol.html">Seven~Functions04#Symbol</a></li><li><a href="module-Seven-Functions04_Var.html">Seven~Functions04#Var</a></li><li><a href="module-Seven-Machine04.html">Seven~Machine04</a></li><li><a href="module-Seven-Machine04_Memory.html">Seven~Machine04#Memory</a></li><li><a href="module-Seven-Machine06.html">Seven~Machine06</a></li><li><a href="module-Seven-Machine06_Memory.html">Seven~Machine06#Memory</a></li><li><a href="module-Seven-Machine13.html">Seven~Machine13</a></li><li><a href="module-Seven-Machine13_Memory.html">Seven~Machine13#Memory</a></li><li><a href="module-Seven-Nest13_Fun.html">Seven~Nest13#Fun</a></li><li><a href="module-Seven-Nest13_Var.html">Seven~Nest13#Var</a></li><li><a href="module-Seven-Parameters06.html">Seven~Parameters06</a></li><li><a href="module-Seven-Parameters06_Fun.html">Seven~Parameters06#Fun</a></li><li><a href="module-Seven-Parameters06_Symbol.html">Seven~Parameters06#Symbol</a></li><li><a href="module-Seven-Parameters06_Var.html">Seven~Parameters06#Var</a></li><li><a href="module-Seven-TCheck01.html">Seven~TCheck01</a></li><li><a href="module-Seven-TCheck02.html">Seven~TCheck02</a></li><li><a href="module-Six-Arithmetic09.html">Six~Arithmetic09</a></li><li><a href="module-Six-Arithmetic10.html">Six~Arithmetic10</a></li><li><a href="module-Six-Control11.html">Six~Control11</a></li><li><a href="module-Six-Eval02.html">Six~Eval02</a></li><li><a href="module-Six-Eval03.html">Six~Eval03</a></li><li><a href="module-Six-Eval04.html">Six~Eval04</a></li><li><a href="module-Six-Functions05.html">Six~Functions05</a></li><li><a href="module-Six-Functions06.html">Six~Functions06</a></li><li><a href="module-Six-Functions07.html">Six~Functions07</a></li><li><a href="module-Six-Functions12.html">Six~Functions12</a></li><li><a href="module-Six-Machine09.html">Six~Machine09</a></li><li><a href="module-Six-Machine10.html">Six~Machine10</a></li><li><a href="module-Six-Machine11.html">Six~Machine11</a></li><li><a href="module-Six-Machine11_Memory.html">Six~Machine11#Memory</a></li><li><a href="module-Six-Postfix08.html">Six~Postfix08</a></li><li><a href="module-Ten-Actions07.html">Ten~Actions07</a></li><li><a href="module-Ten-Actions09.html">Ten~Actions09</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="mixins.list.html" class="dropdown-toggle" data-toggle="dropdown">Mixins<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-BNF-T.html">BNF~T</a></li><li><a href="module-EBNF-Node.html">EBNF~Node</a></li><li><a href="module-Eight-First14.html">Eight~First14</a></li><li><a href="module-Eight-Global01.html">Eight~Global01</a></li><li><a href="module-Eight-Machine01.html">Eight~Machine01</a></li><li><a href="module-Eight-Machine08.html">Eight~Machine08</a></li><li><a href="module-Eight-Machine14.html">Eight~Machine14</a></li><li><a href="module-Eight-Pass08.html">Eight~Pass08</a></li><li><a href="module-Eleven-Build_Bool.html">Eleven~Build_Bool</a></li><li><a href="module-Eleven-Build_Cast.html">Eleven~Build_Cast</a></li><li><a href="module-Eleven-Build_Cmps.html">Eleven~Build_Cmps</a></li><li><a href="module-Eleven-Build_Dcl.html">Eleven~Build_Dcl</a></li><li><a href="module-Eleven-Build_Names.html">Eleven~Build_Names</a></li><li><a href="module-Eleven-Build_Number.html">Eleven~Build_Number</a></li><li><a href="module-Eleven-Build_RD.html">Eleven~Build_RD</a></li><li><a href="module-Eleven-Build_Stmts.html">Eleven~Build_Stmts</a></li><li><a href="module-Eleven-Build_String.html">Eleven~Build_String</a></li><li><a href="module-Eleven-Check_Bool.html">Eleven~Check_Bool</a></li><li><a href="module-Eleven-Check_Cast.html">Eleven~Check_Cast</a></li><li><a href="module-Eleven-Check_Cmps.html">Eleven~Check_Cmps</a></li><li><a href="module-Eleven-Check_Dcl.html">Eleven~Check_Dcl</a></li><li><a href="module-Eleven-Check_Names.html">Eleven~Check_Names</a></li><li><a href="module-Eleven-Check_Number.html">Eleven~Check_Number</a></li><li><a href="module-Eleven-Check_Stmts.html">Eleven~Check_Stmts</a></li><li><a href="module-Eleven-Check_String.html">Eleven~Check_String</a></li><li><a href="module-Eleven-Code_Bool.html">Eleven~Code_Bool</a></li><li><a href="module-Eleven-Code_Cast.html">Eleven~Code_Cast</a></li><li><a href="module-Eleven-Code_Cmps.html">Eleven~Code_Cmps</a></li><li><a href="module-Eleven-Code_Dcl.html">Eleven~Code_Dcl</a></li><li><a href="module-Eleven-Code_Names.html">Eleven~Code_Names</a></li><li><a href="module-Eleven-Code_Number.html">Eleven~Code_Number</a></li><li><a href="module-Eleven-Code_Stmts.html">Eleven~Code_Stmts</a></li><li><a href="module-Eleven-Code_String.html">Eleven~Code_String</a></li><li><a href="module-Eleven-Compile.html">Eleven~Compile</a></li><li><a href="module-Eleven-Eval_Bool.html">Eleven~Eval_Bool</a></li><li><a href="module-Eleven-Eval_Cast.html">Eleven~Eval_Cast</a></li><li><a href="module-Eleven-Eval_Cmps.html">Eleven~Eval_Cmps</a></li><li><a href="module-Eleven-Eval_Dcl.html">Eleven~Eval_Dcl</a></li><li><a href="module-Eleven-Eval_Names.html">Eleven~Eval_Names</a></li><li><a href="module-Eleven-Eval_Number.html">Eleven~Eval_Number</a></li><li><a href="module-Eleven-Eval_Stmts.html">Eleven~Eval_Stmts</a></li><li><a href="module-Eleven-Eval_String.html">Eleven~Eval_String</a></li><li><a href="module-Eleven-Main.html">Eleven~Main</a></li><li><a href="module-Eleven-Symbols.html">Eleven~Symbols</a></li><li><a href="module-Seven-Nest13.html">Seven~Nest13</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">The Chapters<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-01-overview.html">1. Compiler Terminology</a></li><li><a href="tutorial-02-grammars.html">2. Writing Grammars</a></li><li><a href="tutorial-03-scanner.html">3. Scanning Input</a></li><li><a href="tutorial-04-parser.html">4. Recognizing Sentences</a></li><li><a href="tutorial-05-lists.html">5. Translating Sentences</a></li><li><a href="tutorial-06-compile.html">6. Compiling Little Languages</a></li><li><a href="tutorial-07-features.html">7. Language Features</a></li><li><a href="tutorial-08-functions.html">8. Functions as Values</a></li><li><a href="tutorial-09-bootstrap.html">9. Compiling Grammars</a></li><li><a href="tutorial-10-bottom-up.html">10. Recognition Revisited</a></li><li><a href="tutorial-11-trees.html">11. Compiling Revisited</a></li><li><a href="tutorial-a-webpage.html">A: The Practice Page</a></li><li><a href="tutorial-b-machine.html">B: The Stack Machine</a></li><li><a href="tutorial-c-compilers.html">C: The One-Pass Compilers</a></li><li><a href="tutorial-d-kit.html">D: The Compiler Kit</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>B: The Stack Machine</h2>
</header>

<article>
    <h4 id="memory-architecture">Memory Architecture</h4>
<h4 id="instructions">Instructions</h4>
<hr>
<p>The <a href="tutorial-06-compile.html#stack-evaluation">Stack Machine</a>
uses JavaScript functions to simulate machine instructions.
Beginning with <a href="module-Six-Machine10.html"><code>Machine10</code></a>
the machine classes generate and store the instructions in an array <code>code[]</code>
which is considered immutable once filled.</p>
<p>To simplify visual inspection of <code>code[]</code>,
the instructions are implemented through methods of the machine classes.
Methods for simple instructions such as <code>Add</code> directly use <code>memory</code> as an argument,
i.e., they are instruction functions.
Other methods such as <code>Branch</code> require a memory address, etc., as arguments and return
the actual instruction functions.
All of the instruction functions manipulate <code>memory</code> in some way.</p>
<p>There are two interpreters which call the instruction functions:</p>
<ul>
<li>
<p>The <a href="https://en.wikipedia.org/wiki/Stack_machine" title="stack machine"><em>stack machine</em></a> uses one JavaScript array <code>memory</code>
for frames and the value stack.</p>
</li>
<li>
<p>The <a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)" title="garbage collection"><em>garbage-collected stack machine</em></a> uses <code>memory</code>
for global information followed by the value stack,
and individually allocated arrays for the frames.
These arrays have a property <code>.id</code> with a unique value for tracing;
<code>.id</code> is initialized from <code>memory.id</code>.</p>
</li>
</ul>
<p>To enable <a href="tutorial-a-webpage.html">single step execution</a> the interpreters return <code>memory</code>
with a property <code>.continue</code> indicating if the program is suspended (<code>true</code>)
or has terminated (<code>false</code>).</p>
<h3 id="example-6%2F10%3A-arithmetic-expressions"><a href="../eg.html?eg=06/10">Example 6/10</a>: <a href="tutorial-06-compile.html#stack-evaluation">Arithmetic Expressions</a></h3>
<table>
<thead>
<tr>
<th><code>memory</code></th>
<th>use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code> ...</td>
<td>values of global variables</td>
</tr>
<tr>
<td><em>size</em> ...</td>
<td>value stack</td>
</tr>
</tbody>
</table>
<p><a href="module-Six-Machine10.html"><code>Six.Machine10</code></a></p>
<pre class="prettyprint source"><code>Add (memory)                           // stack: ... a b -> ... a+b
Divide (memory)                        // stack: ... a b -> ... a/b
Input (dflt)                             // stack: ... -> ... input
Load (addr)                       // stack: ... -> ... memory[addr]
Minus (memory)                            // stack: ... a -> ... -a
Multiply (memory)                      // stack: ... a b -> ... a*b
Pop (memory)                               // stack: ... val -> ...
Push (result)                           // stack: ... -> ... result
Puts (memory)                  // stack: ... val -> ... | puts(val)
Store (a)            // stack: ... val -> ... val  | memory[a]: val
Subtract (memory)                      // stack: ... a b -> ... a-b
</code></pre>
<h3 id="example-6%2F11%3A-control-structures"><a href="../eg.html?eg=06/11">Example 6/11</a>: <a href="tutorial-06-compile.html#control-structures">Control Structures</a></h3>
<table>
<thead>
<tr>
<th><code>memory</code></th>
<th>use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.pc</code> <em>register</em></td>
<td>next address in <code>code</code> to execute</td>
</tr>
<tr>
<td><code>0</code> ...</td>
<td>values of global variables</td>
</tr>
<tr>
<td><em>size</em> ...</td>
<td>value stack</td>
</tr>
</tbody>
</table>
<p><a href="module-Six-Machine11.html"><code>Six.Machine11 extends Six.Machine10</code></a></p>
<pre class="prettyprint source"><code>Branch (a)                             // stack: ... -> ... | pc: a
Bzero (a)                  // stack: ... bool -> ... | pc: !bool? a
Eq (memory)                         // stack: ... a b -> ... a == b
Ge (memory)                         // stack: ... a b -> ... a >= b
Gt (memory)                          // stack: ... a b -> ... a > b
Le (memory)                         // stack: ... a b -> ... a &lt;= b
Lt (memory)                          // stack: ... a b -> ... a &lt; b
Ne (memory)                         // stack: ... a b -> ... a != b
Print (n)                                // stack: ... n*val -> ...
</code></pre>
<h3 id="example-7%2F04%3A-functions"><a href="../eg.html?eg=07/04">Example 7/04</a>: <a href="tutorial-07-features.html#functions">Functions</a></h3>
<table>
<thead>
<tr>
<th><code>memory</code></th>
<th>use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.pc</code> <em>register</em></td>
<td>next address in <code>code</code> to execute</td>
</tr>
<tr>
<td><code>0</code> ...</td>
<td>values of global variables</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><em>frame</em></td>
<td></td>
</tr>
<tr>
<td><code>+0</code></td>
<td>result value of function call</td>
</tr>
<tr>
<td><code>+1</code></td>
<td>return address in <code>code</code> for function call</td>
</tr>
<tr>
<td>...</td>
<td>stack</td>
</tr>
</tbody>
</table>
<p><a href="module-Seven-Machine04.html"><code>Seven.Machine04 extends Six.Machine11</code></a></p>
<pre class="prettyprint source"><code>// stack: ... -> ... old-pc | pc: addr
Call (addr)   
// stack: ... old-pc -> ,,, 0 old-pc
Entry (memory)   
// stack: ... old-pc -> ... | pc: old-pc
Return (memory)   
// stack: ... x old-pc result -> ... result old-pc result
ReturnValue (memory)   
</code></pre>
<h3 id="example-7%2F06%3A-local-variables"><a id='local-variables'></a><a href="../eg.html?eg=07/06">Example 7/06</a>: <a href="tutorial-07-features.html#local-variables">Local Variables</a></h3>
<table>
<thead>
<tr>
<th><code>memory</code></th>
<th>use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.pc</code> <em>register</em></td>
<td>next address in <code>code</code> to execute</td>
</tr>
<tr>
<td><code>.fp</code> <em>register</em></td>
<td>base address of current frame in <code>memory</code></td>
</tr>
<tr>
<td><code>0</code> ...</td>
<td>values of global variables</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><em>frame</em></td>
<td></td>
</tr>
<tr>
<td><code>+0</code> ...</td>
<td>argument values for the parameters</td>
</tr>
<tr>
<td><code>+</code><em>parms</em></td>
<td>return address in <code>code</code> for function call</td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+1</code></td>
<td><em>dynamic link</em>, i.e., address in <code>memory</code> of previous frame</td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+2</code></td>
<td>result value of function call</td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+3</code> ...</td>
<td>values of local variables</td>
</tr>
<tr>
<td>...</td>
<td>stack</td>
</tr>
</tbody>
</table>
<p><a href="module-Seven-Machine06.html"><code>Seven.Machine06 extends Seven.Machine04</code></a></p>
<pre class="prettyprint source"><code>// stack: ... arguments old-pc
//     -> ... arguments old-pc old-fp result locals
Entry (parms, size)
// stack: ... arguments old-pc old-fp result locals
//     -> ... result old-pc
Exit (parms)
// stack: ... -> ... frame[addr]
LoadFP (addr)
// stack: ... val -> ... val | frame[addr]: val
StoreFP (addr)
</code></pre>
<h3 id="example-7%2F13%3A-nested-functions"><a id='nested-functions'></a><a href="../eg.html?eg=07/13">Example 7/13</a>: <a href="tutorial-07-features.html#nested-functions">Nested Functions</a></h3>
<table>
<thead>
<tr>
<th><code>memory</code></th>
<th>use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.pc</code> <em>register</em></td>
<td>next address in <code>code</code> to execute</td>
</tr>
<tr>
<td><code>.fp</code> <em>register</em></td>
<td>base address of current frame in <code>memory</code></td>
</tr>
<tr>
<td><code>.dp</code> <em>register</em></td>
<td>base address of current display in <code>memory</code></td>
</tr>
<tr>
<td><code>0</code> ...</td>
<td>values of global variables</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><em>frame</em></td>
<td></td>
</tr>
<tr>
<td><code>+0</code> ...</td>
<td>values of parameter arguments</td>
</tr>
<tr>
<td><code>+</code><em>parms</em></td>
<td>return address in <code>code</code> for function call</td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+1</code></td>
<td>address in <code>memory</code> of previous frame</td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+2</code></td>
<td>address in <code>memory</code> of previous display</td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+3</code></td>
<td>result value of function call — <code>memory.dp</code> points here</td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+3+1</code> ...</td>
<td>base addresses of visible frames</td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+3+</code><em>depth</em></td>
<td>base address of this frame — at <em>depth</em></td>
</tr>
<tr>
<td><code>+</code><em>parms</em><code>+4+</code><em>depth</em> ...</td>
<td>values of local variables</td>
</tr>
<tr>
<td>...</td>
<td>stack</td>
</tr>
</tbody>
</table>
<p><a href="module-Seven-Machine13.html"><code>Seven.Machine13 extends Seven.Machine06</code></a></p>
<pre class="prettyprint source"><code>// stack: ... arguments old-pc
//     -> ... arguments old-pc old-fp old-dp result display locals
Entry (parms, depth, size)
// stack: ... arguments old-pc old-fp old-dp result display locals
//     -> ... result old-pc
Exit (memory)
// stack: ... -> ... frame[depth][addr]
LoadDP (addr, depth) 
// stack: ... val -> ... val | frame[depth][addr]: val
StoreDP (addr, depth)
</code></pre>
<h3 id="example-8%2F01%3A-global-first-order-functions"><a href="../eg.html?eg=08/01">Example 8/01</a>: <a href="tutorial-08-functions.html#global-first-order-functions">Global first-order Functions</a></h3>
<p>Same memory layout as <a href="#local-variables">Local Variables</a> above.</p>
<p><a href="module-Eight-Machine01.html">mix-in <code>Eight.Machine01()</code></a></p>
<pre class="prettyprint source"><code>// stack: ... addr -> ... old-pc | pc: addr`
CallValue (memory)  
// stack: ... x-len n*val -> ... n*val x-len`
Rotate (n, len = 1)  
</code></pre>
<h3 id="example-8%2F08%3A-functions-as-argument-values"><a id='functions-as-argument-values'></a><a href="../eg.html?eg=08/08">Example 8/08</a>: <a href="tutorial-08-functions.html#functions-as-argument-values">Functions as Argument Values</a></h3>
<p>Same memory layout as <a href="#nested-functions">Nested Functions</a> above.</p>
<p>This machine requires <em>two</em> slots to represent a function value:
display pointer followed by function start address.
This does not affect the
<a href="module-Seven-Machine04.html#Call"><code>Call</code></a>,
<a href="module-Eight-Machine01.html#CallValue"><code>CallValue</code></a>, and
<a href="module-Seven-Machine04.html#Return"><code>Return</code></a> instructions.</p>
<p><a href="module-Eight-Machine08.html">mix-in <code>Eight.Machine08()</code></a></p>
<pre class="prettyprint source"><code>// stack: ... arguments dp old-pc  
//        -> ... arguments old-pc old-fp old-dp result display locals`
Entry (args, depth, vars)  
// stack: ... arguments old-pc old-fp old-dp result display locals
//        -> ... result old-pc`
Exit (args)  
// stack: ... -> ... dp`
PushDP (memory)  
</code></pre>
<h3 id="example-8%2F14%3A-nested-first-order-functions"><a href="../eg.html?eg=08/14">Example 8/14</a>: <a href="tutorial-08-functions.html#nested-first-order-functions">Nested first-order Functions</a></h3>
<p>This machine manages frames dynamically:
frames are separate arrays subject to JavaScript's garbage collection.</p>
<p>This machine requires <em>two</em> slots to represent a function value:
frame pointer followed by function start address.
This does not affect the
<a href="module-Seven-Machine04.html#Call"><code>Call</code></a>,
<a href="module-Eight-Machine01.html#CallValue"><code>CallValue</code></a>, and
<a href="module-Seven-Machine04.html#Return"><code>Return</code></a> instructions.</p>
<table>
<thead>
<tr>
<th><code>memory</code></th>
<th>use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.pc</code> <em>register</em></td>
<td>next address in <code>code</code> to execute</td>
</tr>
<tr>
<td><code>.fp</code> <em>register</em></td>
<td><code>null</code> or <code>Array</code> of current frame</td>
</tr>
<tr>
<td><code>0</code> ...</td>
<td>values of global variables</td>
</tr>
<tr>
<td>...</td>
<td>stack</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong><code>frame</code></strong></td>
<td><strong>use</strong></td>
</tr>
<tr>
<td><code>0</code></td>
<td>return address in <code>code</code> for function call</td>
</tr>
<tr>
<td><code>1</code></td>
<td><code>null</code> or <code>Array</code> of previous frame</td>
</tr>
<tr>
<td><code>1+1</code> ...</td>
<td>arrays of visible frames</td>
</tr>
<tr>
<td><code>1+</code><em>depth</em></td>
<td><code>Array</code> of this frame (at <em>depth</em>)</td>
</tr>
<tr>
<td><code>2+</code><em>depth</em></td>
<td>result value of function call</td>
</tr>
<tr>
<td><code>3+</code><em>depth</em></td>
<td>extra slot, exactly if result value is function value</td>
</tr>
<tr>
<td>...</td>
<td>argument values</td>
</tr>
<tr>
<td>... <em>frame size</em><code>-1</code></td>
<td>local variable values</td>
</tr>
</tbody>
</table>
<p><a href="module-Eight-Machine14.html">mix-in <code>Eight.Machine14()</code></a></p>
<pre class="prettyprint source"><code>// stack: ... arguments fp old-pc  
//        -> ... | frame: old-pc old-fp display result arguments locals`
Entry (args, depth, result, vars)  
// stack: ... | frame: old-pc old-fp display result ...  
//        -> ... result old-pc | fp: old-fp | frame unchanged`
Exit (depth, result)  
// stack: ... -> ... frame[depth][addr]`
LoadGC (addr, depth)  
// stack: ... -> ... fp`
PushFP (memory)  
// stack: ... val -> ... val | frame[depth][addr]: val`
StoreGC (addr, depth)  
</code></pre>
<h3 id="example-11%2F10%3A-compiling-arithmetic-expressions"><a href="../eg.html?mode=stack&amp;eg=11/10">Example 11/10</a>: <a href="tutorial-11-trees.html#compiling-arithmetic-expressions">Compiling Arithmetic Expressions</a></h3>
<p>This mix-in for code generation extends <a href="module-Six-Machine10.html"><code>Six.Machine10</code></a> with a <code>Power</code> instruction
to support exponentiation.</p>
<p><a href="module-Eleven-Code_Number.html">mix-in <code>Eleven.Code_Number()</code></a></p>
<pre class="prettyprint source"><code>Power (memory)                        // stack: ... a b -> ... a**b
</code></pre>
<h3 id="example-11%2F11%3A-compiling-a-little-language"><a href="../eg.html?mode=stack&amp;eg=11/11">Example 11/11</a>: <a href="tutorial-11-trees.html#compiling-a-little-language">Compiling a Little Language</a></h3>
<p>This mix-in for code generation extends <a href="module-Six-Machine11.html"><code>Six.Machine11</code></a> with a <code>Bnzero</code> instruction
to optimize code generation for <code>while</code> loops.
It requires <a href="module-Eleven-Symbols.html"><code>Eleven.Symbols</code></a>.</p>
<p><a href="module-Eleven-Code_Stmts.html">mix-in <code>Eleven.Code_Stmts()</code></a></p>
<pre class="prettyprint source"><code>Bnzero (a)                  // stack: ... bool -> ... | pc: bool? a
</code></pre>
<h3 id="example-11%2F12%3A-compiling-a-typed-little-language"><a href="../eg.html?mode=stack&amp;eg=11/12">Example 11/12</a>: <a href="tutorial-11-trees.html#compiling-a-typed-little-language">Compiling a Typed Little Language</a></h3>
<p>These mix-ins for code generation extend <a href="module-Six-Machine11.html"><code>Six.Machine11</code></a> with instructions
to support code generation for Boolean and string values and conversions.</p>
<p><a href="module-Eleven-Code_Bool.html">mix-in <code>Eleven.Code_Bool()</code></a></p>
<pre class="prettyprint source"><code>IfTrue (a)             // stack: ... bool -> ... bool | pc: bool? a
IfFalse (a)           // stack: ... bool -> ... bool | pc: !bool? a
Not (memory)                              // stack: ... a -> ... !a
</code></pre>
<p><a href="module-Eleven-Code_String.html">mix-in <code>Eleven.Code_String()</code></a></p>
<pre class="prettyprint source"><code>Concat (memory)                        // stack: ... a b -> ... a+b
Len (memory)                        // stack: ... a -> ... a.length
InputString ('prompt', 'default')       // stack: ... -> ... string
</code></pre>
<p><a href="module-Eleven-Code_Cast.html">mix-in <code>Eleven.Code_Cast()</code></a></p>
<pre class="prettyprint source"><code>Cast ('to', 'from')                   // stack: ... a -> ... cast a
</code></pre>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	Copyright © 2023 Axel T. Schreiner<br>DocStrap Copyright © 2012-2015 The contributors to the JSDoc3 and DocStrap projects.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a>
	
		on Wed Oct 16th 2024
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

  // ats: tutorial t.o.c.
  const tutorial = $('section.tutorial-section');
  if (tutorial.length) {
    const toc = $('<table/>').addClass('tutorial-toc');
    toc.append( $('<tr/>').append( $('<td/>').append(
      $('<ul/>').append(
        tutorial.find('h2, h3').map(function () {
          const h = $(this),
            li = $('<li/>').append(
              $('<a/>').text(h.text()).attr('href', '#'+(h.attr('id') ? h.attr('id') : 'main')));
          return li.append(
            $('<ul/>').append(
              h.nextUntil('h2, h3', 'h4').map(function () {
                const text = $(this).text();
                if (!/^(Next|Prev)/.test(text))
                  return $('<li/>').append(
                    $('<a/>').text(text).attr('href', '#'+$(this).attr('id')));
              }).get()
            )
          );
        }).get()
    ) ) ) );
    tutorial.before(toc);
  }
  
  /* ats: mark links in tutorials */
  $('section.readme-section').toggleClass('readme-section tutorial-section');                   /* README is part of book */
  if ($('section.tutorial-section').size()) {
    const a = $('a[href]'), 
      global = a.filter('[href^="https:"]').addClass('to-other'),
      local = a.not('[href^="https:"]').addClass('to-server');
                       
    global.filter('[href^="https://en.wikipedia.org"]').toggleClass('to-other to-wikipedia');   /* Wikipedia */
    global.filter('[href^="https://developer.mozilla.org"]').toggleClass('to-other to-mdn');    /* MDN documentation */
    
    local.filter('[href^="#"], [href^="tutorial-"], [href="index.html"]').
      toggleClass('to-server to-book');                                                         /* book's text */      
    local.filter('[href^="module-"]').toggleClass('to-server to-doc').
      attr('title', 'documentation and source');                                                /* documentation -> source */
    local.filter('[href^="../m"]').toggleClass('to-server to-methods').
      attr('title', 'method browser');                                                          /* method browser */
    local.filter('[href^="../eg.html?"], [href^="../?m"]').toggleClass('to-server to-eg').
      attr('title', 'example on practice page');                                                /* practice examples */   
  }
  
  const uploadWithServer = (kind) => {
    // README or tutorial
    const tutorial = location.hostname == 'localhost' && /\/doc\/tutorial-/.test(location.pathname);
    if (tutorial || location.hostname == 'localhost' && /\/doc\/index.html/.test(location.pathname)) {
      // create name
      const name = 'html-' + kind +
        (tutorial ? '/tutorial-' + location.pathname.replace(/^.*\/tutorial-/, '') : '/tutorial-00-preface.html');

      // prefix server to all but a.to-book, fix book to xhtml
      const doc = $('.tutorial-section').clone(), a = doc.find('a[href]');
      if (kind == 'epub')
        a.filter('.to-book[href^="tutorial-"]').each(function () {
          $(this).attr('href', $(this).attr('href').replace(/\.html/, ".xhtml"));
        });
      a.not('[href^="https:"], [href^="http:"], .to-book').each(function () {
        $(this).attr('href', 'http://localhost/~axel/EBNF/doc/' + $(this).attr('href')); 
//        $(this).attr('href', 'https://schreiner-family.net/book/doc/' + $(this).attr('href')); 
      });

      // build Form
      const data = new FormData();
      data.append('name', name);
      data.append('html', doc.html());

      // upload
      const xhttp = new XMLHttpRequest();
      xhttp.addEventListener("error", () => alert('upload error'));
      xhttp.addEventListener("readystatechange", () => {
        if (xhttp.readyState === 4) {
          console.log(name, xhttp.status, xhttp.responseText);
        }});
      xhttp.open('POST', '../etc/server.php', true);
      xhttp.send(data);
    }
  };
  
  // ats: rendered HTML w/out sunlight
  uploadWithServer('epub');
  
	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );
    
		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
    
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : false,  //ats
		enableDoclinks : false  //ats
	} );

  $.catchAnchorLinks( {
          navbarOffset: 10
  } );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

  // ats: rendered HTML w/ sunlight
  uploadWithServer('pdf');

  // ats: scroll to parent of first [eExample..](..?..eg=nn/nn..)
  { const m = /eg=[01][0-9]\/[012][0-9]/.exec(location.search);
    if (m) {
      const elt = $('a[href*="' + m[0] + '"]').                         // ? .. eg=nn/nn ..
          not(function() { return ! /^[eE]/.test($(this).text()); }).   // link text starts with [eE]
          first().parent().get(0),                                      // first one's parent
      r = elt.getBoundingClientRect();                                  // position in document 
      window.scrollTo(r.x, r.y - 100);  // need to scroll beyond navigation bar
    }
  }
	  
  } );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>